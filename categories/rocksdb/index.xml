<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Rocksdb on 正小歪 BLOG</title><link>http://hexiangyu.me/categories/rocksdb/</link><description>Recent content in Rocksdb on 正小歪 BLOG</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><lastBuildDate>Sun, 12 Jun 2022 19:46:44 +0000</lastBuildDate><atom:link href="http://hexiangyu.me/categories/rocksdb/index.xml" rel="self" type="application/rss+xml"/><item><title>Rocksdb WAL 流程分析</title><link>http://hexiangyu.me/posts/rocksdb-wal/</link><pubDate>Sun, 12 Jun 2022 19:46:44 +0000</pubDate><guid>http://hexiangyu.me/posts/rocksdb-wal/</guid><description>WAL(Write Ahead Log) 可以将 memtable 的操作做为日志写入磁盘，在发生故障后可以通过 WAL 重建 memtable，恢复到故障前的状态。当 memtable 刷到磁盘上后，这部分 WAL 会被归档，过一段时间后删除。
LOG 格式 一个 LOG 文件由 N 个固定长度的 Block 组成，每个 Block 长度是 kBlockSize(32k)。每个 Block 中由 0 到 N 个Record 组成，如果一个 Record 不足 kBlockSize 会用 null 填充，超过一个 kBlockSize 会用 Type 表示出来。
+-----+-------------+--+----+----------+------+-- ... ----+ File | r0 | r1 |P | r2 | r3 | r4 | | +-----+-------------+--+----+----------+------+-- ... ----+ &amp;lt;--- kBlockSize ------&amp;gt;|&amp;lt;-- kBlockSize ------&amp;gt;| rn = variable size records P = Padding Record 有两种格式一种是 Legacy 另一种的 Recyclable。</description></item></channel></rss>